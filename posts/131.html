<!DOCTYPE html><html lang="en"><head><title>Turning Your Code Inside Out</title><link rel="alternate" type="application/atom+xml" title="Atom feed" href="atom.xml"><meta name="viewport" content="width=device-width,initial-scale=1"><style>a,#p21{text-decoration:none}a:link{color:#00D}a:visited{color:purple}a:hover{text-decoration:underline}body,div{margin:0;padding:0;box-sizing:border-box}body{font:100%/1.5 verdana;color:#222}p,ul,blockquote,pre{margin:0 0 1em}ul{list-style:none;padding-left:1em;text-indent:-1em}h1,h2{font:700 1.27em verdana;margin:0 0 .5em}h1{color:#117}blockquote{font-style:italic}pre,code{font:700 1em "courier new",monospace}pre{overflow:auto}.box{margin:0 auto;padding:0 12px}.s{font:.91em/1.4 verdana}.ab a{display:block;margin:0 0 1em;padding-left:1em;text-indent:-1em}#top{background:#117;color:#FFF;margin:0 0 .67em;border:0 solid #7373D9;border-width:0 0 12px;padding:2em 0 0}#p21{font:700 2.5em georgia;color:#FFF}#perm{color:#222;background:#DDD;border:1px solid #BBB;padding:2px}@media screen and (min-width:768px){blockquote,pre{margin-left:1.25em}.box{max-width:840px}#c1{width:71%;float:left}#c2{width:26%;float:right}}</style></head><body><div id="top"><div class="box"><a id="p21" href="/">programming in&nbsp;the<br>twenty-first century</a><p>It's not about technology for its own sake. It's about being able to implement your ideas.</p></div></div><div class="box"><div id="c1"><h1>Turning Your Code Inside Out</h1><p>If I gave this assignment to a class of novice programmers:</p><blockquote><p>Write a C program to sum the elements of an array and display the results. Include five test cases.</p></blockquote><p>I'd expect multiple people would come up with a function like this:</p><pre>void sum_array(int array[], int size)
{
   int sum = 0;
   for (int i = 0; i &lt; size; i++) {
      sum += array[i];
   }
   printf("the sum of the array is %d\n", sum);
}</pre><p>There's a cute new programmer-ism in that solution: displaying the output is built into <code>sum_array</code> instead of returning the sum and printing it elsewhere. Really, it's hard to see why that one extra line is a bad idea, at least up front. It prevents duplication of the <code>printf</code> call, which is good, right? But tack on an extra requirement such as "Use your array summing function to compute the total sum of three arrays," and there will be an "Ohhhhh, I don't want that print in there" moment.</p><p>The design error was obvious in this example, but it crops up in other cases where it isn't so immediately clear.</p><p>Let's say we're writing a video game and there's a function to spawn an attacker. To alert the player of the incoming danger, there's a sound accompanying the appearance of each new attacker, so it makes sense to play that sound inside <code>new_attacker</code>.</p><p>Now suppose we want to spawn five attackers at the same time by calling <code>new_attacker</code> in a loop. Five attackers are created as expected, but now five identical sounds are starting during the same frame. Those five sounds will be perfectly overlaid on top of each other, at best sounding five times louder than normal and at worst breaking-up because the audio levels are too high. As a bonus, we're taking up five audio channels so the player can hear this mess.</p><p>The solution is conceptually the same as the <code>sum_array</code> example: take the sound playing out of <code>new_attacker</code> and let the caller handle it. Now there's a single function call to start a sound followed by a loop that creates the attackers.</p><p>Why am I bothering to talk about this?</p><p>This method of turning your code inside out is the secret to solving what appear to be hopelessly state-oriented problems in a purely functional style. Push the statefulness to a higher level and let the caller worry about it. Keep doing that as much as you can, and you'll end up with the bulk of the code being purely functional. </p><p>(If you liked this, you might enjoy <a href="23.html">Purely Functional Retrogames</a>.)</p><p class="s"><a href="131.html" id="perm">permalink</a> <i>March 23, 2012</i></p><h1>previously</h1><ul><li><a href=130.html>Solving the Wrong Problem</a><li><a href=129.html>A Complete Understanding is No Longer Possible</a><li><a href=128.html>Don't Fall in Love With Your Technology</a><li><a href=127.html>A Peek Inside the Erlang Compiler</a><li><a href=126.html>Four Levels of Idea Theft</a></ul></div><div id="c2"><h1><a href="archives.html">archives</a></h1><p><b><a href="https://twitter.com/dadgumjames">twitter</a></b> / <b><a href="mailto:james.hague@gmail.com">mail</a></b></p><div class="s"><p>I'm James Hague, a <a href="56.html">recovering programmer</a> who has been designing video games since the 1980s. <a href="195.html">Programming Without Being Obsessed With Programming</a> and <a href="177.html">Organizational Skills Beat Algorithmic Wizardry</a> are good starting points. For the older stuff, try the <a href="162.html">2012 Retrospective</a>.</p><p>Where are <a href="57.html">the comments</a>?</p></div></div></div>